<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>flowchart</title>
        <style type="text/css">
          .end-element { background-color: #FFCCFF; }
        </style>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.0/raphael-min.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        <!--<script src="http://flowchart.js.org/flowchart-latest.js"></script>-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js" integrity="sha256-oivhopCJMytQSLORO8MGp8xn6ZL9Wm7VdPOeIoNglVY=" crossorigin="anonymous"></script>
        <script src="http://www.prime-robotics.com/49c4de3eba53fddcef6e64290f575766/js/fc_base64.js"></script>
        <script src="http://www.prime-robotics.com/49c4de3eba53fddcef6e64290f575766/js/fc_saveSVG.js"></script>
        <!-- <script src="../release/flowchart.min.js"></script> -->
        <script>
            window.onload = function () {
                var btn = document.getElementById("run"),
                    cd = document.getElementById("code"),
                    chart;
                (btn.onclick = function () {
                    var code = cd.value;
                    // if you want to use JSON.parse you need to wrap keys with " (double quotes)
                    // var graphStyle = JSON.parse(JSON.stringify(eval('('+document.getElementById("flowstyle").value+')')));
                    var graphStyle = JSON.parse(document.getElementById("flowstyle").value);

                    if (chart) {
                      chart.clean();
                    }

                    chart = flowchart.parse(code);
                    chart.drawSVG('canvas', {
                      // 'x': 30,
                      // 'y': 50,
                      'line-width': 3,
                      'maxWidth': 3,//ensures the flowcharts fits within a certian width
                      'line-length': 50,
                      'text-margin': 10,
                      'font-size': 14,
                      'font': 'normal',
                      'font-family': 'Helvetica',
                      'font-weight': 'normal',
                      'font-color': 'black',
                      'line-color': 'green',
                      'element-color': 'green',
                      'fill': 'purple',
                      'yes-text': 'yes',
                      'no-text': 'no',
                    //   'arrow-end': 'outline',
                      'arrow-end': 'block',
                      'scale': 1,
                      'symbols': {
                        'start': {
                          'font-color': 'red',
                          'element-color': 'black',
                          'fill': 'pink'
                        },
                        'end':{
                          'class': 'end-element',
                        }
                      },
                      'flowstate' : graphStyle
                    });

                    $('[id^=sub1]').click(function(){
                      alert('info here');
                    });

                    // exportCanvasAsPNG("canvas", "flowchart.png");
                })();
            };

            // var canvas = document.getElementById("mycanvas");
            // var img    = canvas.toDataURL("image/png");
            // var canvas = document.getElementById("canvas");
            // var image = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream"); //Convert image to 'octet-stream' (Just a download, really)
            // window.location.href = image;

        </script>
    </head>
    <body>
        <div>
<textarea id="flowstyle" style="width: 640px;" rows="25">
{
    "starter" : {"fill" : "pink", "element-color" : "purple", "font-color" : "red", "font-weight" : "bold"},
    "ender" : {"fill" : "pink", "element-color" : "purple", "font-color" : "red", "font-weight" : "bold"},
    "past" : { "fill" : "#CCCCCC", "font-size" : 12},
    "current" : {"fill" : "yellow", "font-color" : "red", "font-weight" : "bold"},
    "future" : { "fill" : "#FFFF99"},
    "request" : { "fill" : "blue"},
    "invalid": {"fill" : "#444444"},
    "approved" : { "fill" : "#58C4A3", "font-size" : 12, "yes-text" : "APPROVED", "no-text" : "n/a" },
    "rejected" : { "fill" : "#C45879", "font-size" : 12, "yes-text" : "n/a", "no-text" : "REJECTED" }
}
</textarea>
            <textarea id="code_source" style="width: 640px;" rows="25">
st=>start: Start|past:>http://www.google.com[blank]
e=>end: End:>http://www.google.com
op1=>operation: My Operation|past
op2=>operation: Stuff|current
sub1=>subroutine: My Subroutine|invalid
cond=>condition: Yes
or No?|approved:>http://www.google.com
c2=>condition: Good idea|rejected
io=>inputoutput: catch something...|request

st->op1(right)->cond
cond(yes, right)->c2
cond(no)->sub1(left)->op1
c2(yes)->io->e
c2(no)->op2->e
        </textarea>
        <br>
            <textarea id="code" style="width: 640px;" rows="25">
st=>start: START|starter:>http://www.google.com[blank]
e=>end: END|ender:>http://www.google.com
op1=>operation: My Operation
sub1=>subroutine: My Subroutine
cond=>condition: Yes or No?:>http://www.google.com
cond2=>condition: True or False?:>http://www.google.com
io=>inputoutput: catch something...
io2=>inputoutput: catch more

st(right)->op1->cond
cond(yes)->io(right)->cond2
cond(no)->sub1(right)->op1
cond2(no)->sub1(right)->op1
cond2(yes)->io2->e

        </textarea>
        </div>
        <div>
            <button id="run" type="button">Run</button>&nbsp;&nbsp;
            <input id="filename" type="text" value="plot.svg" />&nbsp;&nbsp;
            <button id="SVGsave" type="button" onclick="saveSVG(document.getElementById('filename').value);">Save SVG</button>
            <button id="PNGsave" type="button" onclick="updateCanvas();">Update Canvas</button>
            <button id="btnTest" type="button" name="png" value="image/svg+xml" onclick="alert(document.getElementById('btnTest').name + ' - ' + document.getElementById('btnTest').value)">PNG</button>
            
            MimeType
            <select id="mimetype">
                <option value="image/png">PNG</option>
                <option value="image/bmp">BMP</option>
                <option value="image/jpeg">JPG</option>
                <option value="image/gif">GIF</option>
                <option value="image/tiff">TIF</option>
            </select>
            <button id="updateCanvas" type="button" onclick="exportCanvasToMimeType();">Export As MimeType</button>
        </div>
        <div id="canvas"></div>
        <!--Image<br />-->
        <!--<img id="myImg" style="border:2px solid black;"><br />-->
        Canvas<br />
        <canvas id="myCanvas" style="border:2px solid black;"></canvas>
    </body>
</html>
